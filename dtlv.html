<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>Datalevin Command Line Tool</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Datalevin</span> <span class="project-version">0.6.16</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1  current"><a href="dtlv.html"><div class="inner"><span>Datalevin Command Line Tool</span></div></a></li><li class="depth-1 "><a href="search.html"><div class="inner"><span>Datalevin Search Engine</span></div></a></li><li class="depth-1 "><a href="server.html"><div class="inner"><span>Datalevin Server/Client</span></div></a></li><li class="depth-1 "><a href="upgrade.html"><div class="inner"><span>Datalevin Database Upgrade</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>datalevin</span></div></div></li><li class="depth-2 branch"><a href="datalevin.client.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>client</span></div></a></li><li class="depth-2 branch"><a href="datalevin.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch"><a href="datalevin.interpret.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>interpret</span></div></a></li><li class="depth-2"><a href="datalevin.search-utils.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>search-utils</span></div></a></li></ul></div><div class="document" id="content"><div class="doc"><div class="markdown"><h1><a href="#datalevin-command-line-tool" name="datalevin-command-line-tool"></a>Datalevin Command Line Tool</h1>
<p><code>dtlv</code> is a native command line tool for Datalevin. The single binary executable can work as an interactive console, a *nix shell command, a Babashka pod, or a server.</p>
<pre><code class="console"><br />$ dtlv help

  Datalevin (version: 0.6.16)

Usage: dtlv [options] [command] [arguments]

Commands:
  copy  Copy a database, regardless of whether it is now in use
  drop  Drop or clear a database
  dump  Dump the content of a database to standard output
  exec  Execute database transactions or queries
  help  Show help messages
  load  Load data from standard input into a database
  repl  Enter an interactive shell
  serv  Run as a server
  stat  Display statistics of database

Options:
  -a, --all                            Include all of the sub-databases
  -c, --compact                        Compact while copying
  -d, --dir PATH                       Path to the database directory
  -D, --delete                         Delete the sub-database, not just empty it
  -f, --file PATH                      Path to the specified file
  -g, --datalog                        Dump/load as a Datalog database
  -h, --help                           Show usage
  -l, --list                           List the names of sub-databases instead of the content
  -p, --port PORT  8898                Listening port number
  -r, --root ROOT  /var/lib/datalevin  Server root data directory
  -v, --verbose                        Show verbose server debug log
  -V, --version                        Show Datalevin version and exit

Type 'dtlv help &lt;command&gt;' to read about a specific command.

</code></pre>
<h2><a href="#interactive-console" name="interactive-console"></a>Interactive Console</h2>
<p>Start <code>dtlv</code> without any arguments or options, or start with <code>dtlv repl</code> command will initiate an interactive console (REPL).</p>
<pre><code class="console">$ dtlv

  Datalevin (version: 0.6.16)

  Type (help) to see available functions. Some Clojure core functions are also available.
  Type (exit) to exit.

user&gt;
</code></pre>
<p>The REPL runs a <a href="https://github.com/borkdude/sci">Simple Clojure Interpreter</a>, so basic Clojure programming is supported, e.g.</p>
<pre><code class="console">user&gt; (+ 1 2 3 4)
10
user&gt;
</code></pre>
<p>As a REPL for Datalevin, all Datalevin <a href="https://juji-io.github.io/datalevin/index.html">public functions</a> can be directly used, without needing to require the namespace.</p>
<pre><code class="console">user&gt; (help)

In addition to some Clojure core functions, the following functions are available:

In namespace datalevin.core

add                   clear                 clear-dbi             close
close-db              close-kv              closed-kv?            closed?
conn-from-datoms      conn-from-db          conn?                 copy
create-conn           datom                 datom-a               datom-e
datom-v               datom?                datoms                db
db?                   dir                   drop-dbi              empty-db
entid                 entity                entity-db             entries
get-conn              get-first             get-range             get-some
get-value             index-range           init-db               k
list-dbis             listen!               open-dbi              open-kv
pull                  pull-many             put-buffer            q
range-count           range-filter          range-filter-count    read-buffer
reset-conn!           resolve-tempid        retract               rseek-datoms
schema                seek-datoms           stat                  tempid
touch                 transact              transact!             transact-async
transact-kv           unlisten!             update-schema         v
with-conn

In namespace datalevin.interpret

exec-code             inter-fn              inter-fn?

In namespace datalevin.client

assign-role           close-database        create-database       create-role
create-user           disconnect-client     drop-database         drop-role
drop-user             grant-permission      list-databases        list-databases-in-use
list-role-permissions list-roles            list-user-permissions list-user-roles
list-users            new-client            query-system          reset-password
revoke-permission     show-clients          withdraw-role

Can call function without namespace: (&lt;function name&gt; &lt;arguments&gt;)

Type (doc &lt;function name&gt;) to read documentation of the function

user&gt; (def conn (get-conn "/tmp/test-db"))
#'user/conn
user&gt; (transact! conn [{:greeting "hello"}])
{:datoms-transacted 1}
user&gt;
</code></pre>
<p>We are unapologetic about the use of Clojure language. Unlike most other database software, the same code for embedded Datalevin library works in the Datalevin REPL. Thereâ€™s no need to learn a new language just for the command line shell.</p>
<h2><a href="#shell-command" name="shell-command"></a>Shell Command</h2>
<p><code>dtlv</code> can be used to execute queries and conduct transactions in shell scripting.</p>
<p><code>dtlv exec</code> executes the followed text as code.</p>
<pre><code class="console">$ dtlv exec '(def conn (get-conn "/tmp/test-db")) \
&gt; (q (quote [:find ?e ?n :where [?e :name ?n]]) @conn) \
&gt; (close conn)'
</code></pre>
<p>If no code is given, <code>dtlv exec</code> takes the code from the standard input. For example, Here Doc is used here to give input:</p>
<pre><code class="console">$ dtlv exec &lt;&lt; EOF
(def conn (get-conn "/tmp/test-db"))
(transact! conn [{:name "world"}])
(q '[:find ?g :where [_ :name ?g]] @conn)
(close conn)
EOF
</code></pre>
<p><code>dtlv</code> is also the tool for database maintenance. etc.</p>
<p>Use <code>dtlv copy</code> to backup databases, optionally compacting the database files.</p>
<pre><code class="console">$ dtlv help copy

  Command copy - Copy the database. This can be done regardless of whether it is
  currently in use.

  Required option:
      -d --dir PATH   Path to the source database directory
  Optional option:
      -c --compact    Compact while copying. Only pages in use will be copied.
  Required argument:
      Path to the destination directory.

  Examples:
      dtlv -d /data/companydb -c copy /backup/companydb-2021-09-14
</code></pre>
<p>Use <code>dtlv dump</code> and <code>dtlv load</code> to export and import databases as text files.</p>
<pre><code class="console">$ dtlv help dump

  Command dump - dump the content of the database or sub-database(s)

  Required option:
      -d --dir PATH   Path to the source database directory
  Optional options:
      -a --all        All of the sub-databases
      -f --file PATH  Write to the specified target file instead of stdout
      -g --datalog    Dump as a Datalog database
      -l --list       List the names of sub-databases instead of the content
  Optional arguments:
      Name(s) of sub-database(s)

  Examples:
      dtlv -d /data/companydb -l dump
      dtlv -d /data/companydb -g dump
      dtlv -d /data/companydb -f ~/sales-data dump sales
      dtlv -d /data/companydb -f ~/company-data -a dump

$ dtlv help load

  Command load - load data into the database or a sub-database.

  Required option:
      -d --dir  PATH  Path to the target database directory
  Optional option:
      -f --file PATH  Load from the specified source file instead of stdin
      -g --datalog    Load a Datalog database
  Optional argument:
      Name of the single sub-database to load the data into, useful when loading
      data into a sub-database with a name different from the original name

  Examples:
      dtlv -d /data/companydb -f ~/sales-data load new-sales
      dtlv -d /data/companydb -f ~/sales-data -g load
</code></pre>
<p><code>dtlv drop</code> and <code>dtlv stat</code> exposes some functionalities of the underlying LMDB databases. <code>dtlv drop</code> clear/delete LMDB sub-databases. <code>dtlv stat</code> show statistics of LMDB sub-databases.</p>
<h2><a href="#babashka-pod" name="babashka-pod"></a>Babashka Pod</h2>
<p>See <a href="https://github.com/juji-io/datalevin#babashka-pod">here</a></p>
<h2><a href="#server-client" name="server-client"></a>Server/client</h2>
<p>See <a href="https://github.com/juji-io/datalevin/blob/master/doc/server.md">here</a></p></div></div></div></body></html>